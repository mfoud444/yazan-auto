import{E as ue,d as E,K as ce,L as Y,k as F,R as me,S as U,aH as pe,i as Z,aI as V,j as L,m as S,t as a,a6 as ge,o as T,c as G,b as w,e as z,u as e,a as l,w as c,z as R,A as h,B as _,l as B,C as H,ai as fe,aj as I,_ as O,p as ve,ak as ye,al as he,a2 as Q,a7 as W,am as be,an as X}from"./index-2283ff34.js";import{N as ee}from"./Grid-2cd1e46d.js";import{N}from"./FormItemGridItem-0cc98245.js";import{N as ae}from"./Upload-cf0fcd47.js";import{N as J,a as Ue}from"./Switch-e5673479.js";import{N as te}from"./Form-ba92273a.js";import{N as q}from"./text-de123031.js";import{N as we}from"./Avatar-82ce1bd1.js";import"./FormItem-38c3009b.js";import"./Image-7f391642.js";const xe=ue("a",`
 cursor: pointer;
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier);
 text-decoration-color: var(--n-text-color);
 color: var(--n-text-color);
`),ke=Object.assign({},Y.props),Ce=E({name:"A",props:ke,setup(v){const{mergedClsPrefixRef:x,inlineThemeDisabled:p}=ce(v),n=Y("Typography","-a",xe,pe,v,x),k=F(()=>{const{common:{cubicBezierEaseInOut:r},self:{aTextColor:C}}=n.value;return{"--n-text-color":C,"--n-bezier":r}}),f=p?me("a",void 0,k,v):void 0;return{mergedClsPrefix:x,cssVars:p?void 0:k,themeClass:f==null?void 0:f.themeClass,onRender:f==null?void 0:f.onRender}},render(){var v;return(v=this.onRender)===null||v===void 0||v.call(this),U("a",{class:[`${this.mergedClsPrefix}-a`,this.themeClass],style:this.cssVars},this.$slots)}});function le(v){const{isMobile:x}=Z(),p=F(()=>x?24:12);V();const n=L(),k=S(null),f=S(!1),r={name:[{required:!0,message:a("common.nameRequired"),trigger:["input","blur"]}],apiUrl:[{required:!0,message:a("common.apiUrlRequired"),trigger:["input","blur"]}],apiKey:[{required:!0,message:a("common.apiKeyRequired"),trigger:["input","blur"]}]},C=async({file:b,data:K,onFinish:y,onError:o,onProgress:m})=>{try{if(!K)throw new Error("dataParams is undefined");const i={loaded:20,total:100},M=Math.round(i.loaded*100/i.total);m({percent:M});const{data:s,error:u}=await ge.storage.from(K.bucket).upload(`${b.name}`,b.file,{cacheControl:"3600",upsert:!1});if(u)if(u.statusCode==="409"&&u.error==="Duplicate")v.value.logoUrl=b.name,y();else throw u;s&&(v.value.logoUrl=s.path,y())}catch(i){console.log(i),n.error(i.message),o()}};function A(){return!v.value.name||!v.value.apiUrl||!v.value.apiKey||f.value}function D(b,K){var y;b.preventDefault(),(y=k.value)==null||y.validate(o=>{o?n.error(a("auth.fillAllField")):K()})}return{span:p,formRef:k,loading:f,rules:r,customRequest:C,isButtonDisabled:A,handleValidateButtonClick:D}}const Ke={class:"border-none shadow-none flex flex-col gap-2 p-2 rounded-lg"},Ae={class:"post-heading mb-1"},Se={class:"gtext text-2xl font-bold underlined"},De={style:{display:"flex","justify-content":"flex-end"}},Ne=E({__name:"Add",setup(v){const x=V(),p=S(x.initState()),{span:n,formRef:k,loading:f,rules:r,customRequest:C,isButtonDisabled:A,handleValidateButtonClick:D}=le(p),b=L();async function K(){try{f.value=!0,await x.insertDataAction(p.value),f.value=!1,x.showModelAdd=!1,b.success(a("common.addSuccess"))}catch(y){f.value=!1,console.error(a("common.addFailed"),y.message),b.error(a("common.addFailed"),y.message)}}return(y,o)=>(T(),G("div",Ke,[w("div",Ae,[w("div",Se,z(e(a)("common.addNew")),1)]),l(e(te),{ref_key:"formRef",ref:k,model:p.value,rules:e(r),size:"large"},{default:c(()=>[w("div",null,[l(e(ee),{span:e(n),"x-gap":24},{default:c(()=>[l(e(N),{span:e(n),path:"logoUrl",label:e(a)("common.logoUrl")},{default:c(()=>[l(e(ae),{accept:"image/*","list-type":"image-card",max:1,data:{bucket:"company"},path:"logoUrl","custom-request":e(C)},null,8,["custom-request"])]),_:1},8,["span","label"]),l(e(N),{span:e(n),path:"name",label:e(a)("common.name")},{default:c(()=>[l(e(R),{value:p.value.name,"onUpdate:value":o[0]||(o[0]=m=>p.value.name=m),onKeyup:o[1]||(o[1]=h(m=>e(D)(m,K),["enter"])),placeholder:e(a)("common.name"),clearable:"",onKeydown:o[2]||(o[2]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(n),path:"companyUrl",label:e(a)("common.companyUrl")},{default:c(()=>[l(e(R),{value:p.value.companyUrl,"onUpdate:value":o[3]||(o[3]=m=>p.value.companyUrl=m),onKeyup:o[4]||(o[4]=h(m=>e(D)(m,K),["enter"])),placeholder:e(a)("common.companyUrl"),clearable:"",onKeydown:o[5]||(o[5]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(n),path:"apiUrl",label:e(a)("common.apiUrl")},{default:c(()=>[l(e(R),{value:p.value.apiUrl,"onUpdate:value":o[6]||(o[6]=m=>p.value.apiUrl=m),onKeyup:o[7]||(o[7]=h(m=>e(D)(m,K),["enter"])),placeholder:e(a)("common.apiUrl"),clearable:"",onKeydown:o[8]||(o[8]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(n),path:"apiKey",label:e(a)("common.apiKey")},{default:c(()=>[l(e(R),{value:p.value.apiKey,"onUpdate:value":o[9]||(o[9]=m=>p.value.apiKey=m),onKeyup:o[10]||(o[10]=h(m=>e(D)(m,K),["enter"])),placeholder:e(a)("common.apiKey"),clearable:"",onKeydown:o[11]||(o[11]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(n),path:"isActivate",label:e(a)("common.isActivate")},{default:c(()=>[l(e(J),{value:p.value.isActivate,"onUpdate:value":o[12]||(o[12]=m=>p.value.isActivate=m),size:"large"},null,8,["value"])]),_:1},8,["span","label"])]),_:1},8,["span"])]),w("div",De,[l(e(B),{type:"primary",style:{width:"100%"},size:"large",loading:e(f),disabled:e(A)(),onClick:o[13]||(o[13]=m=>e(D)(m,K))},{default:c(()=>[H(z(e(a)("common.addNew")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model","rules"])]))}}),ze={class:"border-none shadow-none flex flex-col gap-2 p-2 rounded-lg"},Re={class:"post-heading mb-1"},_e={class:"gtext text-2xl font-bold underlined"},Me={style:{display:"flex","justify-content":"flex-end"}},Be=E({__name:"Update",props:{item:{}},setup(v){const x=v,p=V(),n=S({...x.item}),k=S({...x.item}),f=L(),{span:r,formRef:C,loading:A,rules:D,customRequest:b,isButtonDisabled:K,handleValidateButtonClick:y}=le(n),o=S([{id:"",name:n.value.logoUrl??"",status:"finished",url:n.value.logoUrl}]),m=F(()=>A.value||!n.value.name||!n.value.apiUrl||JSON.stringify(n.value)===JSON.stringify(k.value));async function i(){try{A.value=!0,n.value.logoUrl===k.value.logoUrl&&delete n.value.logoUrl,await p.updateDataAction(n.value),A.value=!1,p.showModelUpdate=!1,f.success(a("common.updateSuccess"))}catch(M){A.value=!1,console.error(a("common.updateFailed"),M.message),f.error(a("common.updateFailed"),M.message)}}return(M,s)=>(T(),G("div",ze,[w("div",Re,[w("div",_e,z(e(a)("common.update")),1)]),l(e(te),{ref_key:"formRef",ref:C,model:n.value,rules:e(D),size:"large"},{default:c(()=>[w("div",null,[l(e(ee),{span:e(r),"x-gap":24},{default:c(()=>[l(e(N),{span:e(r),path:"logoUrl",label:e(a)("common.logoUrl")},{default:c(()=>[l(e(ae),{accept:"image/*","list-type":"image-card",max:1,path:"logoUrl",data:{bucket:"company"},"default-file-list":n.value.logoUrl?o.value:[],"custom-request":e(b)},null,8,["default-file-list","custom-request"])]),_:1},8,["span","label"]),l(e(N),{span:e(r),path:"name",label:e(a)("common.name")},{default:c(()=>[l(e(R),{value:n.value.name,"onUpdate:value":s[0]||(s[0]=u=>n.value.name=u),onKeyup:s[1]||(s[1]=h(u=>e(y)(u,i),["enter"])),placeholder:e(a)("common.name"),clearable:"",onKeydown:s[2]||(s[2]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(r),path:"companyUrl",label:e(a)("common.companyUrl")},{default:c(()=>[l(e(R),{value:n.value.companyUrl,"onUpdate:value":s[3]||(s[3]=u=>n.value.companyUrl=u),onKeyup:s[4]||(s[4]=h(u=>e(y)(u,i),["enter"])),placeholder:e(a)("common.companyUrl"),clearable:"",onKeydown:s[5]||(s[5]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(r),path:"apiUrl",label:e(a)("common.apiUrl")},{default:c(()=>[l(e(R),{value:n.value.apiUrl,"onUpdate:value":s[6]||(s[6]=u=>n.value.apiUrl=u),onKeyup:s[7]||(s[7]=h(u=>e(y)(u,i),["enter"])),placeholder:e(a)("common.apiUrl"),clearable:"",onKeydown:s[8]||(s[8]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(r),path:"apiKey",label:e(a)("common.apiKey")},{default:c(()=>[l(e(R),{value:n.value.apiKey,"onUpdate:value":s[9]||(s[9]=u=>n.value.apiKey=u),onKeyup:s[10]||(s[10]=h(u=>e(y)(u,i),["enter"])),placeholder:e(a)("common.apiKey"),clearable:"",onKeydown:s[11]||(s[11]=h(_(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["span","label"]),l(e(N),{span:e(r),path:"isActivate",label:e(a)("common.isActivate")},{default:c(()=>[l(e(J),{value:n.value.isActivate,"onUpdate:value":s[12]||(s[12]=u=>n.value.isActivate=u),size:"large"},null,8,["value"])]),_:1},8,["span","label"])]),_:1},8,["span"])]),w("div",Me,[l(e(B),{type:"primary",style:{width:"100%"},size:"large",loading:e(A),disabled:m.value,onClick:s[13]||(s[13]=u=>e(y)(u,i))},{default:c(()=>[H(z(e(a)("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model","rules"])]))}}),$e={class:"container_dashboard"},Fe={class:"header_dashboard"},Pe={class:"flex gap-2 justify-end items-center my-2 mt-8"},qe={class:"flex gap-2 items-center"},Te={class:"hidden md:block"},Ee={class:"flex gap-2 items-center"},Ve={class:"hidden md:block"},Ye=E({__name:"List",setup(v){const{iconRender:x}=ye(),p=S(!1),n=S(!1),k=S(!0),f=S(!1),r=V(),C=S([]),{isMobile:A}=Z(),D=fe(),b=L(),K=S(null),y=F(()=>{const t=(i.page-1)*i.pageSize,d=t+i.pageSize;return r.listCompanies.slice(t,d)}),o=S(10),m=F(()=>r.countTotalData),i=I({page:1,pageCount:F(()=>Math.ceil(m.value/o.value)),pageSize:o.value});async function M(t){r.showModelUpdate=!0,K.value=t}const s=I([{title:a("common.name"),key:"name",align:"center",render(t){return U(q,{strong:!0},{default:()=>t.name})}},{title:a("common.companyUrl"),key:"companyUrl",align:"center",render(t){return t.companyUrl?U(Ce,{href:t.companyUrl,target:"_blank"},{default:()=>t.companyUrl}):null},ellipsis:!0},{title:a("common.logoUrl"),key:"logoUrl",align:"center",render(t){const d=t.logoUrl!==null&&t.logoUrl!==void 0&&t.logoUrl.trim()!=="",g=U(O,{icon:"mdi:company",class:"text-lg text-primary"});return d?U(we,{round:!0,src:t.logoUrl,size:"large"}):g},ellipsis:!0},{title:a("common.apiUrl"),key:"apiUrl",align:"center",render(t){return U(q,{type:"info"},{default:()=>t.apiUrl})},ellipsis:!0},{title:a("common.apiKey"),key:"apiKey",align:"center",render(t){return U(q,{type:"info"},{default:()=>t.apiKey})},ellipsis:!0},{title:a("common.isActivate"),key:"isActivate",align:"center",render(t){return U(J,{value:t.isActivate,disabled:!0})}},{title:a("common.createdAt"),key:"createdAt",align:"center",render(t){return U(q,{},{default:()=>new Date(t.createdAt).toLocaleString()})}},{title:a("common.updatedAt"),key:"updatedAt",align:"center",render(t){return U(q,{},{default:()=>new Date(t.updatedAt).toLocaleString()})}}]),u=I([{type:"selection"},...s,{title:a("common.actions"),key:"actions",align:"center",render(t){return U("div",{class:"flex gap-1"},[U(B,{strong:!0,tertiary:!0,size:"small",loading:n.value,style:"border-radius:100%",onClick:async()=>{try{await M(t)}catch(d){console.error(a("common.updateFailed"),d.message)}}},{default:()=>U(x({icon:"fluent:edit-32-regular",color:"blue"}))}),U(B,{strong:!0,tertiary:!0,size:"small",loading:p.value,style:"border-radius:100%",onClick:async()=>{try{oe(t)}catch(d){console.error(a("common.deleteFailed"),d.message)}}},{default:()=>U(x({icon:"fluent:delete-32-regular",color:"red"}))})])}}]);async function $(){try{k.value=!0;const{page:t,pageSize:d}=i;await r.fetchDataAction({limit:d,offset:(t-1)*d}),r.listCompanies=await Promise.all(r.listCompanies.map(async g=>{if(g.logoUrl)try{g.logoUrl=await he(r.bucket,g.logoUrl)}catch(P){console.error(`Failed to fetch image for company ${g.name}:`,P)}return{...g}}))}catch(t){f.value=!0,console.error(a("chat.dataFetchError"),t.message)}finally{k.value=!1}}ve(async()=>{await $()});function oe(t){const d=D.warning({title:a("common.deleteConfirmation"),content:a("common.deleteConfirmationMessage"),positiveText:a("common.yes"),negativeText:a("common.no"),onPositiveClick:async()=>{try{d.loading=!0,await r.deleteDataAction(t.id),b.success(a("common.deleteSuccess"));const g=(i.page-1)*i.pageSize,P=g+i.pageSize;r.listCompanies.slice(g,P).length===0&&i.page>1&&(i.page-=1),await $()}catch{d.loading=!1,b.error(a("common.deleteFailed"))}finally{d.loading=!1}}})}const ne=t=>t.id;function se(t){C.value=t}function re(){const t=D.warning({title:a("common.deleteConfirmation"),content:a("common.deleteConfirmationMessage"),positiveText:a("common.yes"),negativeText:a("common.no"),onPositiveClick:async()=>{try{t.loading=!0,console.log("Selected Row Keys:",C.value);const d=C.value.map(de=>r.deleteDataAction(String(de)));await Promise.all(d),b.success(a("common.deleteSuccess")),await $();const g=(i.page-1)*i.pageSize,P=g+i.pageSize,j=r.listCompanies.slice(g,P);console.log("Current Page Data:",j),j.length===0&&i.page>1&&(i.page-=1),await $()}catch(d){console.error(a("common.deleteFailed"),d.message),b.error(a("common.deleteFailed"))}finally{t.loading=!1}}})}function ie(t){i.page=t,$()}return(t,d)=>(T(),G("div",$e,[w("div",Fe,z(e(a)("common.companes")),1),w("div",null,[w("div",Pe,[l(e(Q),{vertical:""},{default:c(()=>[l(e(Q),{justify:"space-between"},{default:c(()=>[l(e(B),{onClick:d[0]||(d[0]=g=>e(r).showModelAdd=!0),type:"primary"},{default:c(()=>[w("div",qe,[l(e(O),{icon:"mdi:add-bold",class:"text-base"}),w("div",Te,z(e(a)("common.add")),1)])]),_:1}),l(e(B),{strong:"",secondary:"",type:"error",disabled:!(C.value.length>0),onClick:re},{default:c(()=>[w("div",Ee,[l(e(O),{icon:"fluent:delete-32-regular",class:"text-base"}),w("div",Ve,z(e(a)("common.delete")),1)])]),_:1},8,["disabled"])]),_:1}),f.value?(T(),W(e(Ue),{key:1,status:"warning",title:"Error",description:"Error fetching data."},{footer:c(()=>[l(e(B),{onClick:$},{default:c(()=>[H(z(e(a)("common.tryAgain")),1)]),_:1})]),_:1})):(T(),W(e(be),{key:0,remote:"","min-height":e(A)?380:540,"max-height":e(A)?400:700,size:(e(A),"small"),"checked-row-keys":C.value,"onUpdate:checkedRowKeys":[d[1]||(d[1]=g=>C.value=g),se],striped:"",loading:k.value,columns:u,data:y.value,"onUpdate:page":ie,pagination:i,"row-key":ne},null,8,["min-height","max-height","size","checked-row-keys","loading","columns","data","pagination"])),l(e(X),{show:e(r).showModelAdd,"onUpdate:show":d[2]||(d[2]=g=>e(r).showModelAdd=g),"mask-closable":!1,"auto-focus":!1,preset:"card",style:{width:"95%","max-width":"800px"}},{default:c(()=>[l(Ne)]),_:1},8,["show"]),l(e(X),{show:e(r).showModelUpdate,"onUpdate:show":d[3]||(d[3]=g=>e(r).showModelUpdate=g),"mask-closable":!1,"auto-focus":!1,preset:"card",style:{width:"95%","max-width":"800px"}},{default:c(()=>[l(Be,{item:K.value},null,8,["item"])]),_:1},8,["show"])]),_:1})])])]))}});export{Ye as default};
